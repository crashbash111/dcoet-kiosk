<!DOCTYPE html>
<html>
    <head>
        <style>
            html {
                height: 100%;
            }
            body {
                font-family: Helvetica;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            canvas {
                margin: 0;
                padding: 0;
            }
            #ctx {
                width: 100%;
                height: 100%;
            }
            html {
                background: url(./assets/images/background1.png) no-repeat
                    center center fixed;
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
            }
        </style>
    </head>
    <body>
        <canvas id="ctx"></canvas>
        <div
            id="instructions"
            style="position:absolute; top:31.25%; left:32.5%; width:35%; height:32.5%; border-top: 3px solid black; border-left: 3px solid black; border-right: 3px solid black; background:blanchedalmond; text-align: center; display: none"
        >
            <h1 style="font-size:2.5vmin">INSTRUCTIONS</h1>
            <p id="healthInstruct" style="font-size:2vmin"></p>
            <p id="scoreInstruct" style="font-size:2vmin"></p>
            <p id="timeInstruct" style="font-size:2vmin"></p>
            <p id="instructionText" style="font-size:2vmin"></p>
        </div>
        <div
            id="instructionsBTN"
            style="position:absolute; top:63.75%; left:32.5%; width:35%; height:5%; border-bottom: 3px solid black; border-left: 3px solid black; border-right: 3px solid black; background:blanchedalmond; text-align: center; display: none"
        >
            <button
                id="startBtn"
                style="position: absolute; top:5%; left:25%; width:50%; height:45%; font-size:1.5vmin;"
                onclick="startNewGame()"
            >
                Start Game
            </button>
            <button
                id="mainBtn"
                style="position: absolute; top:55%; left:25%; width:50%; height:45%; font-size:1.5vmin;"
                onclick="window.location.href='./mainmenu.html'"
            >
                Main Menu
            </button>
        </div>
        <div
            id="stats"
            style="position:absolute; 
      top: 8px; left: 8px; width: 120px; height: 130px; 
      border-left: 1px solid black; border:  1px solid black; 
      background-image: url( './assets/images/stats.png' ); text-align: left; display: none"
        >
            <h3 id="healthStat"></h3>
            <h3 id="scoreStat"></h3>
            <h3 id="timeStat"></h3>
        </div>
        <div
            id="end"
            style="position:absolute; top:32.5%; left:32.5%; width:35%; height:35%; border: 3px solid black; background:blanchedalmond; text-align: center; display: none"
        >
            <h1 style="font-size:2.5vmin">You Lose</h1>
            <p id="scoreText" style="font-size:2vmin"></p>
            <p id="tappedText" style="font-size:2vmin"></p>
            <p id="rubbishText" style="font-size:2vmin"></p>
            <p id="pestsText" style="font-size:2vmin"></p>
            <p id="animalsText" style="font-size:2vmin"></p>
            <p id="timeText" style="font-size:2vmin"></p>
            <button
                onclick="startNewGame()"
                style="position: absolute; top:90%; left:25%; width:50%; height:8%; font-size:2vmin; text-align: center"
            >
                New Game
            </button>
        </div>
    </body>
    <script>
        var canvas = document.getElementById("ctx");
        var ctx = canvas.getContext("2d");
        ctx.font = "30px Helvetica";

        canvasClick = function(event) {
            var tempW = 50;
            var tempH = 50;
            var { clientX, clientY } = event;
            var ent = {
                x: clientX,
                y: clientY,
                width: tempW,
                height: tempH
            };
            for (var key in rubbishList) {
                if (testCollisionEntity(ent, rubbishList[key])) {
                    delete rubbishList[key];
                    score += 10;
                    tappedRubbish += 1;
                }
                ctx.fillRect(
                    ent.x - tempW / 2,
                    ent.y - tempH / 2,
                    ent.width,
                    ent.height
                );
            }
            for (var key in animalList) {
                if (testCollisionEntity(ent, animalList[key])) {
                    delete animalList[key];
                    score -= 20;
                    health -= 20;
                    tappedAnimals += 1;
                }
                ctx.fillRect(
                    ent.x - tempW / 2,
                    ent.y - tempH / 2,
                    ent.width,
                    ent.height
                );
            }
            for (var key in pestList) {
                if (testCollisionEntity(ent, pestList[key])) {
                    delete pestList[key];
                    score += 20;
                    health += 20;
                    tappedPests += 1;
                }
                ctx.fillRect(
                    ent.x - tempW / 2,
                    ent.y - tempH / 2,
                    ent.width,
                    ent.height
                );
            }
            delete ent;
        };

        canvas.addEventListener("click", canvasClick);

        var timeWhenGameStarted = Date.now();

        var backgroundObj = {};

        var backgroundID = 0;

        var rubbishID = 0;

        var animalID = 0;

        var pestID = 0;

        var frameCount = 0;

        var tappedRubbish = 0;

        var tappedAnimals = 0;

        var tappedPests = 0;

        var score;

        var health;

        var rubbishList = {};

        var animalList = {};

        var pestList = {};

        var imgPaths = {
            bg1: "./assets/images/background1.png",
            bg2: "./assets/images/background2.png",
            r1: "./assets/images/rubbish1.png",
            r2: "./assets/images/rubbish2.png",
            r3: "./assets/images/rubbish3.png",
            rf1: "./assets/images/rubbish1F.png",
            rf2: "./assets/images/rubbish2F.png",
            rf3: "./assets/images/rubbish3F.png",
            a1: "./assets/images/animal1.png",
            a2: "./assets/images/animal2.png",
            a3: "./assets/images/animal3.png",
            af1: "./assets/images/animal1F.png",
            af2: "./assets/images/animal2F.png",
            af3: "./assets/images/animal3F.png",
            p1: "./assets/images/pest1.png",
            p2: "./assets/images/pest2.png",
            p3: "./assets/images/pest3.png",
            pf1: "./assets/images/pest1F.png",
            pf2: "./assets/images/pest2F.png",
            pf3: "./assets/images/pest3F.png"
        };

        var img0 = new Image();
        img0.src = imgPaths.bg1;

        var img1 = new Image();
        img1.src = imgPaths.bg2;

        var img2 = new Image();
        img2.src = imgPaths.r1;

        var img3 = new Image();
        img3.src = imgPaths.r2;

        var img4 = new Image();
        img4.src = imgPaths.r3;

        var img5 = new Image();
        img5.src = imgPaths.rf1;

        var img6 = new Image();
        img6.src = imgPaths.rf2;

        var img7 = new Image();
        img7.src = imgPaths.rf3;

        var img8 = new Image();
        img8.src = imgPaths.a1;

        var img9 = new Image();
        img9.src = imgPaths.a2;

        var img10 = new Image();
        img10.src = imgPaths.a3;

        var img11 = new Image();
        img11.src = imgPaths.af1;

        var img12 = new Image();
        img12.src = imgPaths.af2;

        var img13 = new Image();
        img13.src = imgPaths.af3;

        var img14 = new Image();
        img14.src = imgPaths.p1;

        var img15 = new Image();
        img15.src = imgPaths.p2;

        var img16 = new Image();
        img16.src = imgPaths.p3;

        var img17 = new Image();
        img17.src = imgPaths.pf1;

        var img18 = new Image();
        img18.src = imgPaths.pf2;

        var img19 = new Image();
        img19.src = imgPaths.pf3;

        var imgList = [
            img0,
            img1,
            img2,
            img3,
            img4,
            img5,
            img6,
            img7,
            img8,
            img9,
            img10,
            img11,
            img12,
            img13,
            img14,
            img15,
            img16,
            img17,
            img18,
            img19
        ];

        Image = function(id, imgId) {
            var img = new Image();
            img.src = imgPaths[imgId];

            imgList[id] = img;
        };

        Background = function(imgId) {
            var background = {
                imgId: imgId
            };
            backgroundObj = background;
        };

        Rubbish = function(id, x, y, spdX, spdY, width, height, imgId, side) {
            var rubbish = {
                x: x,
                spdX: spdX,
                y: y,
                spdY: spdY,
                id: id,
                width: width,
                height: height,
                imgId: imgId,
                side: side
            };
            rubbishList[id] = rubbish;
        };

        Animal = function(id, x, y, spdX, width, height, imgId, side) {
            var animal = {
                x: x,
                spdX: spdX,
                y: y,
                spdY: 0,
                id: id,
                width: width,
                height: height,
                imgId: imgId,
                side: side
            };
            animalList[id] = animal;
        };

        Pest = function(id, x, y, spdX, width, height, imgId, side) {
            var pest = {
                x: x,
                spdX: spdX,
                y: y,
                spdY: 0,
                id: id,
                width: width,
                height: height,
                imgId: imgId,
                side: side
            };
            pestList[id] = pest;
        };

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min)) + min;
        }

        randomlyGenerateRubbish = function() {
            if (health > 0) {
                var side = getRandomInt(0, 2);
                var x = Math.random() * (canvas.width - 10) + 10;
                var y = 0;
                // var height = 10 + Math.random() * 30;
                // var width = 10 + Math.random() * 30;
                var height = 100;
                var width = 100;
                var id = rubbishID++;
                var spdX =
                    10 +
                    Math.random() * 20 +
                    (frameCount / 1000) * (frameCount / 1000);
                var spdY = 2 + Math.random() * 2 + frameCount / 1000;
                var imgId = getRandomInt(2, 5);
                Rubbish(id, x, y, spdX, spdY, width, height, imgId, side);
            }
        };

        randomlyGenerateAnimal = function() {
            if (health > 0) {
                var side = getRandomInt(0, 2);
                if (side == 0) {
                    var x = 0;
                } else {
                    var x = canvas.width;
                }
                var y = canvas.height - 40;
                // var height = 10 + Math.random() * 30;
                // var width = 10 + Math.random() * 30;
                var height = 140;
                var width = 140;
                var id = animalID++;
                var spdX = 1 + Math.random() * 20 * (side == 0 ? 1 : -1);
                var imgId = getRandomInt(8, 11);
                Animal(id, x, y, spdX, width, height, imgId, side);
            }
        };

        randomlyGeneratePest = function() {
            if (health > 0) {
                var side = getRandomInt(0, 2);
                if (side == 0) {
                    var x = 0;
                } else {
                    var x = canvas.width;
                }
                var y = canvas.height - 40;
                // var height = 10 + Math.random() * 30;
                // var width = 10 + Math.random() * 30;
                var height = 140;
                var width = 140;
                var id = pestID++;
                var spdX = 1 + Math.random() * 20 * (side == 0 ? 1 : -1);
                var imgId = getRandomInt(14, 17);
                Pest(id, x, y, spdX, width, height, imgId, side);
            }
        };

        updateRubbishEntity = function(something) {
            updateRubbishPosition(something);
            drawEntity(something);
        };

        updateAnimalEntity = function(something) {
            updateAnimalPosition(something);
            drawEntity(something);
        };

        updatePestEntity = function(something) {
            updatePestPosition(something);
            drawEntity(something);
        };

        updateRubbishPosition = function(something) {
            something.x += something.spdX;
            something.y += something.spdY;
            something.spdY += 0.5;

            if (something.spdX > 0) {
                something.spdX -= 0.3;
            } else if (something.spdX < 0) {
                something.spdX += 0.3;
            }

            if (something.x < 0 || something.x > canvas.width) {
                something.spdX *= -1;
            }

            if (something.y > canvas.height - 10) {
                // health -= 15;
                // score -= 10;
                for (var key in rubbishList) {
                    if (something === rubbishList[key]) {
                        delete rubbishList[key];
                    }
                }
            }
        };

        updateAnimalPosition = function(something) {
            something.x += something.spdX;
            if (something.side == 0) {
                if (something.x > canvas.width) {
                    for (var key in animalList) {
                        if (something === animalList[key]) {
                            delete animalList[key];
                        }
                    }
                }
            } else {
                if (something.x < 0) {
                    for (var key in animalList) {
                        if (something === animalList[key]) {
                            delete animalList[key];
                        }
                    }
                }
            }
        };

        updatePestPosition = function(something) {
            something.x += something.spdX;

            if (something.side == 0) {
                if (something.x > canvas.width) {
                    for (var key in pestList) {
                        if (something === pestList[key]) {
                            delete pestList[key];
                        }
                    }
                }
                if (something.x > canvas.width - 10) {
                    health -= 20;
                    score -= 30;
                    for (var key in pestList) {
                        if (something === pestList[key]) {
                            delete pestList[key];
                        }
                    }
                }
            }
        };

        drawEntity = function(something) {
            ctx.save();

            ctx.drawImage(
                imgList[something.imgId + something.side * 3],
                something.x - something.width / 2,
                something.y - something.height / 2,
                something.width,
                something.height
            );
            ctx.restore();
        };

        getDistanceBetweenEntity = function(entity1, entity2) {
            //return distance (number)
            var vx = entity1.x - entity2.x;
            var vy = entity1.y - entity2.y;
            return Math.sqrt(vx * vx + vy * vy);
        };

        testCollisionEntity = function(entity1, entity2) {
            var rect1 = {
                x: entity1.x - entity1.width / 2,
                y: entity1.y - entity1.height / 2,
                width: entity1.width,
                height: entity1.height
            };

            var rect2 = {
                x: entity2.x - entity2.width / 2,
                y: entity2.y - entity2.height / 2,
                width: entity2.width,
                height: entity2.height
            };

            return testCollisionRectRect(rect1, rect2);
        };

        testCollisionRectRect = function(rect1, rect2) {
            return (
                rect1.x <= rect2.x + rect2.width &&
                rect2.x <= rect1.x + rect1.width &&
                rect1.y <= rect2.y + rect2.height &&
                rect2.y <= rect1.y + rect1.height
            );
        };

        document.getElementById("instructions").style.display = "block";
        document.getElementById("healthInstruct").innerHTML =
            "Health lowers when rubbish hits the ground or pests make it through";
        document.getElementById("scoreInstruct").innerHTML =
            "Score increases when you destroy rubbish or pests";
        document.getElementById("timeInstruct").innerHTML =
            "Time is how long the current round has lasted";
        document.getElementById("instructionText").innerHTML =
            "Tap rubbish or pests, be careful not to tap non-pests!";
        document.getElementById("instructionsBTN").style.display = "block";

        update = function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frameCount++;
            var time = (new Date() - timeWhenGameStarted) / 1000;
            var t = time.toFixed(1);

            if (frameCount % 30 == 0) {
                randomlyGenerateRubbish();
            }

            if (frameCount % 45 == 0) {
                randomlyGenerateAnimal();
            }

            if (frameCount % 50 == 0) {
                randomlyGeneratePest();
            }

            if (health <= 50) {
                backgroundObj.imgId = 1;
            }

            // ctx.drawImage(
            //   imgList[backgroundObj.imgId],
            //   0,
            //   0,
            //   (ctx.canvas.width = innerWidth),
            //   (ctx.canvas.height = innerHeight)
            // );

            // ctx.drawImage(
            //     imgList[backgroundObj.imgId],
            //     x of clip,
            //     y of clip,
            //     width of clip,
            //     height of clip,
            //     x on canvas,
            //     y on canvas,
            //     width on canvas,
            //     height on canvas
            // );

            ctx.drawImage(
                imgList[backgroundObj.imgId],
                0,
                0,
                this.width,
                this.height,
                0,
                0,
                (ctx.canvas.width = innerWidth),
                (ctx.canvas.height = innerHeight)
            );

            // var styles = {
            //     htmlElement: {
            //         background:
            //             "url(./assets/images/background1.png) no-repeat center center fixed",
            //         WebkitBackgroundSize: "cover",
            //         MozBackgroundSize: "cover",
            //         OBackgroundSize: "cover",
            //         backgroundSize: "cover"
            //     }
            // };

            for (var key in rubbishList) {
                updateRubbishEntity(rubbishList[key]);
            }

            for (var key in animalList) {
                updateAnimalEntity(animalList[key]);
            }

            for (var key in pestList) {
                updatePestEntity(pestList[key]);
            }

            if (health <= 0) {
                myStopFunction();
                health = 0;
                for (var key in rubbishList) {
                    delete rubbishList[key];
                }
                rubbishList = {};

                for (var key in animalList) {
                    delete animalList[key];
                }
                animalList = {};

                for (var key in pestList) {
                    delete pestList[key];
                }
                pestList = {};

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                document.getElementById("end").style.display = "block";
                document.getElementById("scoreText").innerHTML =
                    "Score: " + score;
                document.getElementById("tappedText").innerHTML =
                    "You got rid of: ";
                if (tappedRubbish < 1 || tappedRubbish > 1) {
                    document.getElementById("rubbishText").innerHTML =
                        tappedRubbish + " pieces of rubbish";
                } else if (tappedRubbish == 1) {
                    document.getElementById("rubbishText").innerHTML =
                        tappedRubbish + " piece of rubbish";
                }
                if (tappedPests < 1 || tappedPests > 1) {
                    document.getElementById("pestsText").innerHTML =
                        tappedPests + " pest animals";
                } else if (tappedPests == 1) {
                    document.getElementById("pestsText").innerHTML =
                        tappedPests + " pest animal";
                }
                if (tappedAnimals < 1 || tappedAnimals > 1) {
                    document.getElementById("animalsText").innerHTML =
                        tappedAnimals + " non-pest animals";
                } else if (tappedAnimals == 1) {
                    document.getElementById("animalsText").innerHTML =
                        tappedAnimals + " non-pest animal";
                }
                document.getElementById("timeText").innerHTML =
                    "You Survived for: " + t + " seconds";
            }
            document.getElementById("stats").style.display = "block";
            document.getElementById("healthStat").innerHTML =
                "Health: " + health;
            document.getElementById("scoreStat").innerHTML = "Score: " + score;
            document.getElementById("timeStat").innerHTML = "Time: " + t;
        };

        var myVar;

        startNewGame = function() {
            ctx.canvas.width = innerWidth;
            ctx.canvas.height = innerHeight;
            document.getElementById("end").style.display = "none";
            document.getElementById("instructions").style.display = "none";
            document.getElementById("instructionsBTN").style.display = "none";
            timeWhenGameStarted = Date.now();
            frameCount = 0;
            health = 100;
            score = 0;
            tappedRubbish = 0;
            tappedAnimals = 0;
            tappedPests = 0;
            Background(0);
            rubbishList = {};
            animalList = {};
            pestList = {};
            randomlyGenerateRubbish();
            randomlyGenerateAnimal();
            randomlyGeneratePest();
            myVar = setInterval(update, 40);
        };

        function myStopFunction() {
            clearInterval(myVar);
        }
    </script>
</html>
